RUTA: Copilot-Log-Fixes.md
Descripción: Registro de incidencias y soluciones aplicadas por Copilot para consulta futura (wiki técnica).

- Incidencia: Errores Angular al servir la app tras crear app-customers-widget.
  - Mensajes:
    - NG8002: "Can't bind to 'attr-title' since it isn't a known property of 'span'".
    - TS-998113: "NgClass is not used within the template of CustomersWidgetComponent" (warning).
  - Contexto: Introducidos al agregar el componente app-customers-widget y su plantilla.
  - Causa raíz:
    - Uso de attr-title en spans, atributo inválido para binding en Angular; debe usarse title.
    - Módulo NgClass importado sin uso real en la plantilla.
  - Resolución aplicada:
    - Reemplazar attr-title por title en la plantilla del widget.
    - Eliminar NgClass de la lista de imports del componente.
    - Limpieza adicional alineada a la guía:
      - Quitar FormsModule (no se usa [(ngModel)] en el widget).
      - Cambiar a inyección por constructor.
      - Añadir namespace de i18n propio customersWidget y mensajes de tabla en ngx-datatable.
      - Alinear propiedad phoneNumber con el backend.
  - Archivos modificados/creados relevantes:
    - src/app/components/widgets/customers-widget.component.html: reemplazo de attr-title por title; mensajes i18n; binding de phoneNumber; messages en ngx-datatable.
    - src/app/components/widgets/customers-widget.component.ts: remoción de NgClass/FormsModule de imports; constructor injection; consumo de API; definición de columnas con sortable.
    - public/locale/es.json y public/locale/en.json: claves customersWidget.* (management, table, dialog).
    - src/app/models/customer.model.ts: modelo alineado a CustomerVM (id, name, email, phoneNumber...).
    - src/app/services/customers-endpoint.service.ts: endpoints /api/customer (GET/POST/PUT/DELETE).
    - src/app/services/customers.service.ts: servicio de dominio para el widget.
  - Verificación:
    - Compilación correcta posterior a los cambios; errores NG8002 resueltos y warning de NgClass eliminado.

- Incidencia: Error TS2339 en customers-widget.component.ts (getDialogType no existe en AlertService).
  - Mensaje:
    - TS2339: Property 'getDialogType' does not exist on type 'AlertService'.
  - Causa raíz:
    - Uso de un método inexistente al llamar showStickyMessage/showMessage.
  - Resolución aplicada:
    - Reemplazar el tercer parámetro por el enum MessageSeverity.error proporcionado por AlertService.
    - Importar MessageSeverity desde alert.service.
  - Archivo modificado:
    - src/app/components/widgets/customers-widget.component.ts.
  - Verificación:
    - Compilación correcta tras el cambio; el error TS2339 desaparece.

- Incidencia: NG8002 en customers.component.html por propiedad [verticalScrollbar] no reconocida en <app-customers-widget>.
  - Causa raíz:
    - CustomersComponent no estaba marcado como standalone, impidiendo el correcto uso del array imports y reconocimiento del input del componente hijo.
  - Resolución aplicada:
    - Se añadió standalone: true en el decorador de CustomersComponent.
    - Se añadió también standalone: true en CustomersWidgetComponent para seguir el patrón de todo-demo.
  - Verificación:
    - Compilación correcta posterior al ajuste; error NG8002 resuelto.

- Incidencia: HTTP 400 (Bad Request) al editar en línea un cliente
  - Mensaje:
    - PUT https://localhost:7085/api/customer/{id} 400 (Bad Request) desde customers-widget.component.ts:93.
  - Causa raíz:
    - El endpoint PUT en backend aceptaba string y no actualizaba; además, enviar parches parciales rompe validación si se exige Name/Gender.
  - Resolución aplicada:
    - Backend: Se reimplementó CustomerController PUT para aceptar CustomerVM y delegar una actualización parcial sobre ICustomerService.UpdatePartial. Se agregó GET por id.
    - Core: Se extendió ICustomerService con GetById y UpdatePartial; se implementó en CustomerService aplicando únicamente campos no nulos, incluyendo parseo de Gender.
    - Cliente: Sin cambios de contrato; sigue enviando parches parciales y ahora el backend los aplica.
  - Verificación (confirmada):
    - En /customers, la edición inline (nombre/email/teléfono) actualiza sin errores (DevTools: 200 OK).
    - Al recargar, GET devuelve los cambios persistidos.
    - No se requieren migraciones.
    - Opcional: proteger CustomerController con [Authorize] si se necesitan restricciones por roles/claims.

- Ajustes de lint en cliente
  - Mensajes:
    - no-empty-lifecycle-method en ngOnDestroy, y no-explicit-any en updateValue.
  - Resolución aplicada:
    - ngOnDestroy ahora limpia this.editing.
    - Se reemplazó any por Record<string, unknown> y se tiparon arrays con índice.
  - Verificación:
    - Build correcto y sin errores de compilación.

- Incidencia: Falta de funcionalidad de alta de clientes en CustomersWidget
  - Contexto:
    - El widget permitía buscar, editar en línea y eliminar, pero no crear nuevos clientes desde la UI.
  - Resolución aplicada:
    - Plantilla (customers-widget.component.html):
      - Se agregó botón "Nuevo Cliente" que despliega un formulario inline.
      - Formulario ligero con campos Nombre, Email y Teléfono, botón Agregar/Guardar con spinner e iconos, y Cancelar.
    - Componente (customers-widget.component.ts):
      - Estado de alta (addingNew, savingNew, newCustomer) y métodos startAddNew, cancelAdd, onNewInputChange, create.
      - Validación básica: nombre requerido y email con regex; mensajes usando i18n y AlertService.
      - Llamada a CustomersService.create(payload) y recarga de la grilla al éxito; reseteo de formulario.
      - Ajuste de regex para pasar ESLint (no-useless-escape).
    - i18n:
      - Nuevas claves en public/locale/es.json y public/locale/en.json: customersWidget.management.NewCustomer y customersWidget.editor.* (Add, Saving, NameRequired, EmailRequired, InvalidEmail).
  - Archivos modificados/creados relevantes:
    - src/app/components/widgets/customers-widget.component.html
    - src/app/components/widgets/customers-widget.component.ts
    - public/locale/es.json
    - public/locale/en.json
  - Verificación:
    - Compilación correcta tras los cambios; el formulario se muestra/oculta correctamente.
    - Alta exitosa contra /api/customer (201/200) y la tabla recarga los datos.
    - Validación previene envío si faltan nombre/correo o correo inválido.
    - No se requieren migraciones de base de datos.
