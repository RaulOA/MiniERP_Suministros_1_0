RUTA: Copilot-Log-Fixes.md
Descripción: Registro de incidencias y soluciones aplicadas por Copilot para consulta futura (wiki técnica).

YYYY-MM-DD HH-MM| Archivos Modificados | Solicitud o tema | Cambio o Solucion | Fallo conocido (opc.) | Vars | Etiquetas.

2024-04-01 | Users Management (SPA) | Alta de usuario | Validado el flujo de alta: el formulario captura todos los campos obligatorios, la solicitud responde correctamente (200/201) y el usuario aparece en el listado tras actualizar. Se verificó que las traducciones i18n se muestran correctamente durante todo el proceso. Esta validación asegura que el flujo de alta es robusto y que la experiencia de usuario es consistente, facilitando futuras ampliaciones o refactorizaciones del módulo de usuarios. | - | - | users, alta, i18n

2024-04-01 | public/locale/es.json | Error carga i18n | Se detectó error de parseo por JSON truncado en el archivo de traducciones. Se reescribió el archivo alineando todas las claves con en.json y extendiendo con claves faltantes, asegurando paridad y evitando futuros fallos de carga. Esta acción previene errores de internacionalización y mejora la mantenibilidad del sistema de traducciones. | "Http failure during parsing" | - | i18n, json, traducción

2024-04-01 | customers-widget.component.html, customers-widget.component.ts | Errores Angular en widget | Se reemplazó attr-title por title en la plantilla, se eliminaron NgClass y FormsModule de los imports, y se alinearon propiedades y mensajes i18n. Además, se ajustó el binding de phoneNumber para mantener consistencia con el backend. Estas acciones mejoran la compatibilidad con Angular, eliminan warnings y aseguran que el widget siga las mejores prácticas recomendadas. | NG8002, warning NgClass | - | angular, widget, lint

2024-04-01 | customers-widget.component.ts | Error método AlertService | Se sustituyó la llamada a un método inexistente por el uso del enum MessageSeverity.error y se corrigió la importación. Esto garantiza que las alertas se gestionen correctamente y previene errores de compilación relacionados con cambios en la API de AlertService. | TS2339 | - | angular, alert, enum

2024-04-01 | customers.component.html, CustomersComponent | Error input no reconocido | Se marcó CustomersComponent y CustomersWidgetComponent como standalone, permitiendo el uso correcto de inputs y el reconocimiento de propiedades en componentes hijos. Esta acción facilita la modularidad y el mantenimiento del código, alineando la arquitectura con el patrón standalone de Angular. | NG8002 | - | angular, standalone

2024-04-01 | CustomerController.cs, ICustomerService.cs, CustomerService.cs | PUT cliente: error 400 | Se modificó el endpoint PUT para aceptar CustomerVM y aplicar actualizaciones parciales, agregando también GET por id. El cliente sigue enviando parches parciales, pero ahora el backend los procesa correctamente. Esta mejora permite mayor flexibilidad en la edición y reduce errores por validaciones estrictas, optimizando la interoperabilidad entre frontend y backend. | HTTP 400 | - | api, backend, patch

2024-04-01 | customers-widget.component.ts | Lint: ngOnDestroy y tipado | Se mejoró la limpieza de recursos en ngOnDestroy y se tipó updateValue con Record<string, unknown>. Esto refuerza la calidad del código, previene fugas de memoria y mejora la mantenibilidad al evitar el uso de any. | - | - | lint, tipado

2024-04-01 | customers-widget.component.html, customers-widget.component.ts, CustomerController.cs, ICustomerService.cs, CustomerService.cs | Alta de clientes en widget | Se añadió un formulario inline para alta de clientes, con validaciones y payload alineado al backend. Se implementó POST en el backend y auditoría automática. Esta funcionalidad amplía la cobertura del widget, mejora la experiencia de usuario y asegura trazabilidad de cambios, facilitando futuras ampliaciones y mantenibilidad. | - | - | alta, widget, api, auditoría

2025-08-20 | MiniERP_Suministros.Core/Services/Shop/Interfaces/IProductCategoryService.cs, MiniERP_Suministros.Core/Services/Shop/ProductCategoryService.cs, MiniERP_Suministros.Core/Services/Shop/Exceptions/ProductCategoryException.cs | Core: ProductCategory (servicio) | Se creó el contrato e implementación del servicio de categorías (consultas con Include/ThenInclude, Create, UpdatePartial, Delete) y una excepción específica. Compilación OK; no se requieren migraciones. Lección: replicar patrón de Customer acelera nuevas entidades; usar AsNoTracking/AsSingleQuery en lecturas y evitar Delete si hay dependencias para prevenir errores de FK. | última-revisión:2025-08-20 | - | core, servicio, categorías, backend, pendientes

2025-08-20 | MiniERP_Suministros.Server/Program.cs, MiniERP_Suministros.Server/Configuration/MappingProfile.cs, MiniERP_Suministros.Server/ViewModels/Shop/ProductCategoryVM.cs, MiniERP_Suministros.Server/Controllers/ProductCategoryController.cs | Server: ProductCategory (DI, VM, API) | Registrado IProductCategoryService en DI, creado ProductCategoryVM con validación (FluentValidation), agregado mapeo AutoMapper y controlador REST (GET, GET id, POST, PUT parcial, DELETE con conflicto si hay productos). Compilación OK. Lección: reutilizar patrón de Customer minimiza fricción; validar Name y manejar dependencias con 409/Conflict. | - | - | server, api, automapper, di, categorías

2025-08-20 | MiniERP_Suministros.client/src/app/** (models/product-category.model.ts, services/product-categories-*.ts, components/widgets/product-categories-widget.*), components/products/products.component.* | Client: Widget categorías de producto | Se creó modelo, endpoints y servicio de dominio; widget standalone con buscador, alta inline, edición inline y eliminación. Integrado en ProductsComponent. Lección: replicar patrón de CustomersWidget agiliza desarrollo; centralizar validación de longitud y usar alerts consistentes. | - | - | angular, widget, api, categorías

2025-08-20 | MiniERP_Suministros.client/public/locale/{es,en}.json, components/widgets/product-categories-widget.component.html | i18n: Widget categorías | Agregadas claves productsWidget.* en es/en y alineadas referencias en la plantilla. Lección: separar namespaces por widget y evitar reciclar claves de otros módulos para mantener consistencia y escalabilidad. | última-revisión:2025-08-20 | - | i18n, angular, categorías

2025-08-20 | MiniERP_Suministros.Core/Services/Shop/Interfaces/IProductService.cs, MiniERP_Suministros.Core/Services/Shop/ProductService.cs, MiniERP_Suministros.Core/Services/Shop/Exceptions/ProductException.cs | Core: Product (servicio) | Definido contrato CRUD y consultas (Include) para productos; implementado ProductService with Create/UpdatePartial/Delete y validaciones (precios y stock >= 0, categoría/padre existentes); creada excepción ProductException. Compilación OK. Lección: mantener validaciones de integridad y bloquear Delete si hay hijos o detalles de orden. | - | - | core, productos, servicio, validación

2025-08-20 | public/locale/en.json | Error carga i18n (en) | Se corrigió JSON truncado reescribiendo el archivo completo y validando llaves abiertas/cerradas. Lección: al editar i18n grandes, usar validadores/formatters y revisar diffs antes de guardar para evitar fallos de build. | "Expected string in JSON but found end of file" | - | i18n, json, build

2025-08-20 | MiniERP_Suministros.Core/Services/Shop/Interfaces/IOrdersService.cs, MiniERP_Suministros.Core/Services/Shop/OrdersService.cs | Core: Orders (servicio) | Definido contrato para pedidos con encabezado y detalles (OrderItemDraft). Implementado OrdersService: consultas con Include, Create (valida disponibilidad, descuenta stock), UpdatePartial y Delete (restaura stock). Compilación OK. Lección: transacción atómica y validaciones tempranas previenen inconsistencias de stock; añadir RowVersion en futuro para concurrencia. | - | - | core, pedidos, servicio, stock

2025-08-20 | MiniERP_Suministros.Server/Program.cs, MiniERP_Suministros.Server/Configuration/MappingProfile.cs, MiniERP_Suministros.Server/ViewModels/Shop/OrderVM.cs, MiniERP_Suministros.Server/ViewModels/Shop/OrderItemVM.cs, MiniERP_Suministros.Server/Controllers/OrdersController.cs | Server: Orders (API, VM, mapping) | Se creó OrdersController (GET/GET id/POST/PUT/DELETE), se ampliaron VM de Order y detalle, y se configuró mapeo AutoMapper para Order/OrderDetail. DI ya registrada. Lección: reutilizar patrón de Customer/ProductCategory para acelerar; exponer Items en VM y filtrar por cajero para usuarios no admin. | - | - | server, api, automapper, pedidos

2025-08-20 | MiniERP_Suministros.client/src/app/** (models/order.model.ts, services/orders-*.ts, components/widgets/orders-widget.*), components/orders/orders.component.*; MiniERP_Suministros.Server/** (OrdersController, OrderVM, OrderItemVM, MappingProfile) | Client+Server: Orders (componente y API) | Cliente: modelo, endpoints y servicio de pedidos; widget standalone integrado en OrdersComponent con lista + editor inline (encabezado y líneas), búsqueda y delete. i18n agregado (ordersWidget.*) en es/en. Servidor: OrdersController y VMs mapeadas en AutoMapper. Lección: seguir New-Component-Steps.md acelera entrega, mantener paridad i18n y usar componentes standalone simplifica integración. | - | - | angular, widget, api, orders, i18n

2025-08-20 | MiniERP_Suministros.client/src/app/components/widgets/orders-widget.component.* | Client: Orders (fix build) | Corregido template y módulo: se añadió CommonModule para pipes date/number, se ajustó bucle @for a la sintaxis Angular 17+ ("item of list; track $index") y se eliminó NgbTooltip no usado. Build OK. Lección: al crear componentes standalone, importar CommonModule para pipes comunes y validar nuevas sintaxis de control flow. | NG5002, NG8004, TS-998113 | - | angular, widget, build, pipes

2025-08-21 09-00 | MiniERP_Suministros.client/package.json, MiniERP_Suministros.client/start-ng-ssl.js | npm warning DEP0190 en start | Se reemplazó run-script-os por un lanzador Node (start-ng-ssl.js) que ejecuta ng serve con SSL sin shell=true, eliminando el warning DEP0190. Mantiene el prestart que genera el cert con aspnetcore-https.js. Lección: preferir spawn sin shell y scripts multiplataforma en Node para evitar deprecations y riesgos de shell injection. | [DEP0190] | - | angular, npm, seguridad, dev-server

2025-08-21 09-20 | MiniERP_Suministros.client/start-ng-ssl.js, MiniERP_Suministros.client/package.json | SpaProxy no inicia + WebRootPath warning | start-ng-ssl.js: forzar --host=localhost y --port=4200 para alinear con <SpaProxyServerUrl>=https://localhost:4200; package.json: prestart con --name fijo para el certificado. Resultado: SpaProxy conecta y la SPA carga en https. Nota: el warning de WebRootPath es informativo; crear MiniERP_Suministros.Server/wwwroot solo si se servirán archivos estáticos desde el backend. | "Couldn't start the SPA development server with command 'npm start'"; "The WebRootPath was not found: ... wwwroot. Static files may be unavailable." | SpaProxyLaunchCommand=npm start; SpaProxyServerUrl=https://localhost:4200 | angular, spa-proxy, https, wwwroot, warning

2025-08-21 09-35 | MiniERP_Suministros.client/package.json, MiniERP_Suministros.client/start-ng-ssl.js | SpaProxy: npm start no arranca | package.json: corregido comando start (añadir .js). start-ng-ssl.js: invocación robusta del CLI con require.resolve + process.execPath; host=localhost y port=4200 para alinear con SpaProxy. Resultado: SpaProxy inicia y proxea correctamente. | "Couldn't start the SPA development server with command 'npm start'" | SpaProxyLaunchCommand=npm start; SpaProxyServerUrl=https://localhost:4200 | angular, spa-proxy, dev-server, cli

2025-08-21 09-45 | MiniERP_Suministros.Server/Program.cs | Warning StaticFileMiddleware (wwwroot) | Se condicionó la configuración de archivos estáticos (UseDefaultFiles/MapStaticAssets) a la existencia de wwwroot. Si no existe, no se registra middleware y se elimina el warning. Lección: evitar warnings en desarrollo cuando la SPA se sirve por dev-server. | "The WebRootPath was not found: ... wwwroot. Static files may be unavailable." | wwwrootPath=ContentRoot/wwwroot | aspnetcore, static-files, warning, spa
